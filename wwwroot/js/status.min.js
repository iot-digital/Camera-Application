"use strict";let timeOut=setTimeout(refresh,6e5),connection=new signalR.HubConnectionBuilder().withUrl("/dashboardhub").build();function reconnect(){connection.start().then(function(){console.log("********signalR reconnected*************")}).catch(function(t){return console.error(t.toString())})}function refresh(){console.log("**********refreshing****************"),connection.connection.stop(),location=window.location.href}function updateCardValues(t){let e=document.getElementById("devices").innerText.split(",").map(t=>Number(t));for(let n=0;n<t.length;n++)e.indexOf(t[n].id)>-1&&(updateCardHeader(t[n]),updateCardData(t[n]),updateCardFooter(t[n]))}function updateCardData(t){1==t.displayCard?updateSimpleSwitchCardData(t):10==t.displayCard&&updateSimpleSensorCardData(t)}function updateSimpleSwitchCardData(t){let e=document.getElementById("d-"+t.id+"-data");t.isRunning?e.innerHTML='<div class="spinner-border text-warning" style="width: 4rem; height: 4rem;"></div>':t.isOnline?"ON"==t.lastValue?e.innerText.includes("OFF")||(e.innerHTML=formatSimpleSwitchContent("on"),updateSimpleSwitchButton(t,"OFF")):"OFF"==t.lastValue?e.innerText.includes("OFF")||(e.innerHTML=formatSimpleSwitchContent("off"),updateSimpleSwitchButton(t,"ON")):e.innerHTML=formatSimpleSwitchContent("na"):e.innerHTML=formatSimpleSwitchContent("na")}function formatSimpleSwitchContent(t){return`<div class="light-status light-status-${t}"><div class="d-flex justify-content-center align-items-end"><h2 style="margin-top:28px;font-size:32px;">${t.toUpperCase()}</h2></div></div>`}function updateSimpleSwitchButton(t,e){try{document.getElementById("d-"+t.id+"-form-lv").value=e;document.getElementById("d-"+t.id+"-form-sub").value="Turn Lights "+e}catch(n){console.log(n)}}function updateSimpleSensorCardData(t){if(void 0==t.lastValue||0==t.lastValue.length)return;let e=[];t.lastValue.indexOf(",")>0?e=t.lastValue.split(","):e.push(t.lastValue);let n=[];if(1==e.length)document.getElementById("d-"+t.id+"-data").innerText=e[0];else{let i=document.getElementsByClassName("sensor-value");for(let a=0;a<i.length;a++){let r="d-"+t.id+"-data";i[a].getAttribute("deviceId")==r&&n.push(i[a])}for(let o=0;o<n.length;o++)void 0!=e[o]&&(n[o].innerText=e[o])}}function updateCardHeader(t){let e=!1,n=document.getElementById("d-"+t.id+"-con");t.isOnline?"OFFLINE"==n.innerText&&(n.innerText="ONLINE",e=!0):"ONLINE"==n.innerText&&(n.innerText="OFFLINE",e=!0),e&&(n.classList.toggle("bg-success"),n.classList.toggle("bg-danger"))}function updateCardFooter(t){let e=document.getElementById("d-"+t.id+"-pow");if(0==t.powerInputType){if(e.classList.contains("bi-plug"))return;updateBatteryIcon(e,t.powerState,"bi-plug",!0);return}if(1==t.powerInputType){if(t.powerState>50&&t.powerState<=100){if(e.classList.contains("bi-battery-full")){updateTooltip(e,batPercent+"%");return}updateBatteryIcon(e,t.powerState,"bi-battery-full",!1);return}if(t.powerState<=50&&t.powerState>20){if(e.classList.contains("bi-battery-half")){updateTooltip(e,batPercent+"%");return}updateBatteryIcon(e,t.powerState,"bi-battery-half",!1),e.classList.toggle("text-primary");return}if(t.powerState<=20){if(e.classList.contains("bi-battery")){updateTooltip(e,batPercent+"%");return}updateBatteryIcon(e,t.powerState,"bi-battery",!1),e.classList.toggle("text-danger");return}}}function updateBatteryIcon(t,e,n,i){removeBatteryClass(t),t.classList.toggle(n),i?updateTooltip(t,"Plugged-In"):updateTooltip(t,e+"%")}function removeBatteryClass(t){t.classList.contains("bi-battery-full")&&t.classList.toggle("bi-battery-full"),t.classList.contains("bi-battery-half")&&t.classList.toggle("bi-battery-half"),t.classList.contains("bi-battery")&&t.classList.toggle("bi-battery"),t.classList.contains("text-danger")&&t.classList.toggle("text-danger"),t.classList.contains("text-primary")&&t.classList.toggle("text-primary"),t.classList.contains("bi-plug")&&t.classList.toggle("bi-plug")}function updateTooltip(t,e){t.setAttribute("data-bs-title",e);let n=bootstrap.Tooltip.getInstance("#"+t.id);n.setContent({".tooltip-inner":e})}connection.on("ReceiveMessage",function(t){console.log("**********reached****************"),console.log(t),"reload_page"==t?(connection.connection.stop(),location=window.location.href):(updateCardValues(t),clearTimeout(timeOut),timeOut=setTimeout(refresh,6e5))}),connection.onclose(reconnect),connection.start().then(function(){console.log("********signalR started*************")}).catch(function(t){return console.error(t.toString())});